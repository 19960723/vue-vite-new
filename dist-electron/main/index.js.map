{"version":3,"file":"index.js","sources":["../../electron/main/menu.ts","../../electron/main/window.ts","../../electron/main/index.ts"],"sourcesContent":["const { Menu, MenuItem } = require('electron');\r\n\r\nconst customMenu = new Menu();\r\ncustomMenu.append(new MenuItem({ label: 'Menu Item 1' }));\r\ncustomMenu.append(new MenuItem({ label: 'Menu Item 2' }));\r\n\r\n// 给菜单添加自定义 CSS 类\r\n// customMenu.popupOptions = {\r\n//   className: 'custom-menu',\r\n// };\r\n\r\n// 在窗口上设置右键菜单事件监听器\r\n// window.addEventListener('contextmenu', (event) => {\r\n//   event.preventDefault();\r\n//   customMenu.popup();\r\n// });\r\n","import { app, BrowserWindow, shell, screen, systemPreferences, ipcMain } from 'electron';\r\n\r\nlet mainWindow: BrowserWindow | null = null;\r\n// 初始化窗口\r\nexport function initWindow() {\r\n  mainWindow = BrowserWindow.getFocusedWindow();\r\n  mainWindow?.once('focus', () => {\r\n    initWindow();\r\n  });\r\n}\r\n// 获取当前窗口信息\r\nipcMain.on('get-window-info', (event) => {\r\n  event.returnValue = {\r\n    id: mainWindow?.id,\r\n    title: mainWindow?.getTitle(),\r\n    bounds: mainWindow?.getBounds(),\r\n  };\r\n});\r\n// 获取所有的窗口列表\r\nipcMain.on('get-all-win', (event) => {\r\n  const winList = BrowserWindow?.getAllWindows();\r\n  const win_list = winList.map((v) => {\r\n    return {\r\n      id: v.id,\r\n      title: v.title,\r\n    };\r\n  });\r\n  event.returnValue = {\r\n    win_list,\r\n  };\r\n  console.log(win_list);\r\n});\r\n//隐藏窗口\r\nipcMain.on('hide-win', () => {\r\n  mainWindow?.hide();\r\n});\r\n//显示窗口\r\nipcMain.on('show-win', () => {\r\n  mainWindow?.show();\r\n});\r\n//关闭窗口\r\nipcMain.on('close-win', () => {\r\n  mainWindow?.close();\r\n});\r\n//聚焦窗口\r\nipcMain.on('focus-win', () => {\r\n  mainWindow?.focus();\r\n});\r\n//置顶窗口\r\nipcMain.on('setAlwaysOnTop', (e, flag) => {\r\n  mainWindow?.setAlwaysOnTop(flag);\r\n});\r\n// 获取窗口位置\r\nipcMain.on('get-win-position', (e) => {\r\n  const pos = mainWindow?.getPosition();\r\n  e.returnValue = {\r\n    pos,\r\n  };\r\n});\r\n// 设置窗口位置\r\nipcMain.on('set-win-position', (e, message) => {\r\n  const { x, y } = message;\r\n  mainWindow?.setPosition(parseInt(x), parseInt(y));\r\n});\r\n// 最小化\r\nipcMain.on('minimize', () => {\r\n  mainWindow?.minimize();\r\n});\r\n// 最大化\r\nipcMain.on('maximize', () => {\r\n  mainWindow?.maximize();\r\n});\r\n","import { app, BrowserWindow, shell, screen, systemPreferences, ipcMain } from 'electron';\r\nimport { release } from 'node:os';\r\nimport { join } from 'node:path';\r\nimport './menu';\r\nimport { initWindow } from './window';\r\n// The built directory structure\r\n//\r\n// ├─┬ dist-electron\r\n// │ ├─┬ main\r\n// │ │ └── index.js    > Electron-Main\r\n// │ └─┬ preload\r\n// │   └── index.js    > Preload-Scripts\r\n// ├─┬ dist\r\n// │ └── index.html    > Electron-Renderer\r\n//\r\nprocess.env.DIST_ELECTRON = join(__dirname, '..');\r\nprocess.env.DIST = join(process.env.DIST_ELECTRON, '../dist');\r\nprocess.env.PUBLIC = process.env.VITE_DEV_SERVER_URL\r\n  ? join(process.env.DIST_ELECTRON, '../public')\r\n  : process.env.DIST;\r\n\r\n// Disable GPU Acceleration for Windows 7\r\nif (release().startsWith('6.1')) app.disableHardwareAcceleration();\r\n\r\n// Set application name for Windows 10+ notifications\r\nif (process.platform === 'win32') app.setAppUserModelId(app.getName());\r\n\r\nif (!app.requestSingleInstanceLock()) {\r\n  app.quit();\r\n  process.exit(0);\r\n}\r\n\r\nlet isHasScreen = false;\r\nasync function checkAndApplyDevicePrivilege() {\r\n  const cameraPrivilege = systemPreferences.getMediaAccessStatus('camera');\r\n\r\n  if (cameraPrivilege !== 'granted') {\r\n    await systemPreferences.askForMediaAccess('camera');\r\n  }\r\n\r\n  const micPrivilege = systemPreferences.getMediaAccessStatus('microphone');\r\n\r\n  if (micPrivilege !== 'granted') {\r\n    await systemPreferences.askForMediaAccess('microphone');\r\n  }\r\n\r\n  const screenPrivilege = systemPreferences.getMediaAccessStatus('screen');\r\n  console.log(screenPrivilege);\r\n  if (screenPrivilege === 'granted') {\r\n    isHasScreen = true;\r\n  }\r\n}\r\n\r\n// Remove electron security warnings\r\n// This warning only shows in development mode\r\n// Read more on https://www.electronjs.org/docs/latest/tutorial/security\r\n// process.env['ELECTRON_DISABLE_SECURITY_WARNINGS'] = 'true'\r\n\r\nlet win: BrowserWindow | null = null;\r\n// Here, you can also use other preload\r\nconst preload = join(__dirname, '../preload/index.js');\r\nconst url = process.env.VITE_DEV_SERVER_URL;\r\nconst indexHtml = join(process.env.DIST, 'index.html');\r\nasync function createWindow() {\r\n  await checkAndApplyDevicePrivilege();\r\n  const { width, height } = screen.getPrimaryDisplay().workAreaSize;\r\n  win = new BrowserWindow({\r\n    title: 'Main window',\r\n    width,\r\n    height,\r\n    minWidth: 1200,\r\n    minHeight: 640,\r\n    // autoHideMenuBar: true,\r\n    icon: join(process.env.PUBLIC, 'favicon.ico'),\r\n    webPreferences: {\r\n      preload,\r\n      // Warning: Enable nodeIntegration and disable contextIsolation is not secure in production\r\n      // Consider using contextBridge.exposeInMainWorld\r\n      // Read more on https://www.electronjs.org/docs/latest/tutorial/context-isolation\r\n      nodeIntegration: true,\r\n      contextIsolation: false,\r\n    },\r\n  });\r\n  if (process.env.VITE_DEV_SERVER_URL) {\r\n    // electron-vite-vue#298\r\n    const installExtension = require('electron-devtools-installer');\r\n    installExtension\r\n      .default(installExtension.VUEJS_DEVTOOLS)\r\n      .then(() => {})\r\n      .catch((err: Error) => {\r\n        console.log('Unable to install `vue-devtools`: \\n', err);\r\n      });\r\n    win.loadURL(url);\r\n    // Open devTool if the app is not packaged\r\n    win.webContents.openDevTools();\r\n  } else {\r\n    win.loadFile(indexHtml);\r\n  }\r\n\r\n  // Test actively push message to the Electron-Renderer\r\n  win.webContents.on('did-finish-load', () => {\r\n    win?.webContents.send('main-process-message', { isHasScreen });\r\n  });\r\n\r\n  // Make all links open with the browser, not with the application\r\n  win.webContents.setWindowOpenHandler(({ url }) => {\r\n    if (url.startsWith('https:')) shell.openExternal(url);\r\n    return { action: 'deny' };\r\n  });\r\n  // win.webContents.on('will-navigate', (event, url) => { }) #344\r\n\r\n  initWindow();\r\n}\r\n\r\napp.whenReady().then(createWindow);\r\n\r\napp.on('window-all-closed', () => {\r\n  win = null;\r\n  if (process.platform !== 'darwin') app.quit();\r\n});\r\n\r\napp.on('second-instance', () => {\r\n  if (win) {\r\n    // Focus on the main window if the user tried to open another\r\n    if (win.isMinimized()) win.restore();\r\n    win.focus();\r\n  }\r\n});\r\n\r\napp.on('activate', () => {\r\n  const allWindows = BrowserWindow.getAllWindows();\r\n  if (allWindows.length) {\r\n    allWindows[0].focus();\r\n  } else {\r\n    createWindow();\r\n  }\r\n});\r\n\r\n// New window example arg: new windows url\r\nipcMain.handle('open-win', (_, arg) => {\r\n  const { title } = arg;\r\n  const winList = BrowserWindow?.getAllWindows();\r\n  const findWin = winList.find((v) => v.title == title);\r\n  if (findWin) {\r\n    findWin.show();\r\n    return;\r\n  }\r\n\r\n  const childWindow = new BrowserWindow({\r\n    ...arg,\r\n    webPreferences: {\r\n      preload,\r\n      nodeIntegration: true,\r\n      contextIsolation: false,\r\n    },\r\n  });\r\n  initWindow();\r\n  if (process.env.VITE_DEV_SERVER_URL) {\r\n    childWindow.loadURL(`${url}#${title}`);\r\n  } else {\r\n    childWindow.loadFile(indexHtml, { hash: arg });\r\n  }\r\n});\r\n"],"names":["BrowserWindow","ipcMain","join","release","app","systemPreferences","screen","url","shell"],"mappings":"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"}